# ðŸª YukkiMusic Cookies System

> **Cookie Management for YouTube Downloads via yt-dlp**

---

## ðŸ“‹ Table of Contents

1. [Overview](#-overview)
2. [Why Cookies?](#-why-cookies)
3. [How It Works](#-how-it-works)
4. [Setup Methods](#-setup-methods)
5. [Cookie Format](#-cookie-format)
6. [Troubleshooting](#-troubleshooting)
7. [Advanced Usage](#-advanced-usage)

---

## ðŸŒŸ Overview

The **Cookies System** in YukkiMusic enables the `yt-dlp` downloader to authenticate with YouTube and bypass certain restrictions when downloading videos.

**Location**: `internal/cookies/`

### What This Directory Does

```
internal/cookies/
â”œâ”€â”€ README.md                 # This file
â”œâ”€â”€ cookies.go               # Cookie management logic
â”œâ”€â”€ cookies1.txt             # Cookie file #1
â”œâ”€â”€ cookies2.txt             # Cookie file #2
â””â”€â”€ cookies_N.txt            # Cookie file #N
```

Every `.txt` file in this directory is:
- âœ… Loaded on startup
- âœ… Randomly selected for each download
- âœ… Used by yt-dlp for authentication
- âœ… Automatically updated from remote sources

---

## ðŸ¤” Why Cookies?

### Problems They Solve

| Problem | Solution |
|---------|----------|
| **Age-restricted videos** | Cookies prove account is old enough |
| **Geographic restrictions** | Cookies help bypass region locks |
| **Rate limiting** | Authenticated requests get higher limits |
| **Expired access tokens** | Cookies maintain login state |
| **Video unavailability** | More likely to access with auth |

### When You Need Cookies

```
âŒ WITHOUT COOKIES           âœ… WITH COOKIES
â”œâ”€ Can't download youtube audio/videos
â”œâ”€ Limited to public content         
â”œâ”€ Low rate limits                   
â””â”€ May block requests                

âœ… WITH COOKIES
â”œâ”€ Access all your account's videos
â”œâ”€ Higher rate limits
â”œâ”€ Less likely to be blocked
â””â”€ Better success rate
```

---

## âš™ï¸ How It Works

### Initialization Flow

```
Bot Starts
    â†“
cookies.go init() called
    â†“
Check COOKIES_LINK env variable
    â†“
For each URL in COOKIES_LINK:
    Download from Batbin â†’ Save as .txt
    â†“
Load all .txt files from directory
    â†“
Cache file paths in memory
    â†“
Ready for downloads
```

### Download Flow

```
User requests song
    â†“
yt-dlp downloader invoked
    â†“
GetRandomCookieFile() called
    â†“
Pick random .txt from cache
    â†“
Pass to yt-dlp: --cookies cookies.txt
    â†“
yt-dlp authenticates with YouTube
    â†“
Video downloaded successfully
```

### Code Flow

```go
// 1. On startup
func init() {
    urls := strings.Fields(config.CookiesLink)
    for _, url := range urls {
        downloadCookieFile(url)  // Download from Batbin
    }
}

// 2. When downloading
func (p *YtDlpPlatform) Download(...) (string, error) {
    cookieFile, err := cookies.GetRandomCookieFile()
    // Use in yt-dlp:
    args = append(args, "--cookies", cookieFile)
}

// 3. Cache management
var cachedFiles []string  // Cached on startup
func GetRandomCookieFile() (string, error) {
    return cachedFiles[rand.Intn(len(cachedFiles))]
}
```

---

## ðŸ“¥ Setup Methods

### Method 1: Batbin URLs (Recommended)

**What is Batbin?**  
Batbin is a temporary file hosting service perfect for storing cookies without exposing them in git.

**Steps**:

1. **Export Browser Cookies**
   - Install extension: [Get cookies.txt](https://chrome.google.com/webstore/detail/get-cookiestxt/)
   - Visit youtube.com
   - Click extension â†’ Export
   - Copy cookie data

2. **Upload to Batbin**
   - Go to https://batbin.me/
   - Paste cookies
   - Click "Create Paste"
   - Copy the paste ID from URL
   - Example: `https://batbin.me/abc123def456`

3. **Configure Bot**
   ```bash
   # Single cookie
   COOKIES_LINK=https://batbin.me/paste_id1
   
   # Multiple cookies (for load balancing)
   COOKIES_LINK=https://batbin.me/paste_id1 https://batbin.me/paste_id2 https://batbin.me/paste_id3
   ```

4. **Bot Auto-Downloads**
   - On startup, bot fetches cookies from Batbin URLs
   - Saves as `internal/cookies/paste_id.txt`
   - Automatically used for downloads

**Pros**:
- âœ… No git commits needed
- âœ… Easy to update
- âœ… Secure (not in repo)
- âœ… Multiple sources for redundancy

**Cons**:
- âš ï¸ Cookies expire periodically

---

### Method 2: Manual Files (Fallback)

**Direct File Placement**:

1. Export cookies as described above
2. Place in `internal/cookies/` directory

```bash
# Create cookie file manually
cat > internal/cookies/my_cookies.txt << 'EOF'
# Netscape HTTP Cookie File
# This file is generated by Get cookies.txt! Extension
# https://chrome.google.com/webstore/detail/get-cookiestxt/

.youtube.com	TRUE	/	TRUE	0	__Secure-1PSID	value_here
.youtube.com	TRUE	/	TRUE	0	__Secure-3PSID	value_here
# ... more cookies
EOF
```

3. Bot automatically discovers and loads `*.txt` files

**Pros**:
- âœ… No external dependencies
- âœ… Always available
- âœ… Works offline

**Cons**:
- âš ï¸ Needs git commits (avoid!)
- âš ï¸ Manual updates required

---

## ðŸª Cookie Format

### Standard Netscape Format

```
# Netscape HTTP Cookie File
# This file is generated by Get cookies.txt! Extension

# Each line represents one cookie:
# domain    flag    path    secure    expiry    name    value

.youtube.com	TRUE	/	TRUE	0	__Secure-1PSID	AabCDef1234...
.youtube.com	TRUE	/	TRUE	0	__Secure-3PSID	GhiJKlm5678...
.youtube.com	TRUE	/	TRUE	0	VISITOR_INFO1_LIVE	xyz123abc456...
.youtube.com	TRUE	/	TRUE	0	YSC	_hWvMnOpQrSt
youtube.com	FALSE	/	FALSE	0	PREF	yt=UwgA7hWvMn
```
## ðŸ› Troubleshooting

### Issue 1: "No cookie files found"

**Error**:
```
WARN Failed to load cookie cache: no cookie files found
```

**Solution**:
1. Check `internal/cookies/` directory exists
2. Verify `.txt` files are present
3. Check file permissions: `chmod 644 internal/cookies/*.txt`
4. If using Batbin, verify `COOKIES_LINK` is set

```bash
# Check directory
ls -la internal/cookies/

# Should show files like:
# -rw-r--r--  1 user  group  2048 Dec 17 10:30 abc123.txt
# -rw-r--r--  1 user  group  2048 Dec 17 10:30 def456.txt
```

---

### Issue 2: "Download failed - 403 Forbidden"

**Error**:
```
ERROR yt-dlp Sign in to confirm youâ€™re not a bot.
```

**Causes & Solutions**:

```
âŒ Cookies expired
   â†’ Regenerate cookies from browser
   â†’ Upload new Batbin paste
   â†’ Update COOKIES_LINK

âŒ Wrong format
   â†’ Export again using Get cookies.txt extension
   â†’ Verify Netscape format headers

âŒ YouTube blocked IP
   â†’ Try different cookies from different accounts
   â†’ Use multiple cookies (load balanced)
   â†’ Wait a few hours before retry

âŒ Account suspended
   â†’ Use different YouTube account
   â†’ Export fresh cookies from that account
```

---

### Issue 3: "GetRandomCookieFile called on empty cache"

**Error**:
```
WARN No cookie files found in cache
```

**Solution**:
1. Call `loadCookieCache()` first time
2. If still empty, check directory:

```bash
# Verify files exist
find internal/cookies -name "*.txt" -type f

# If none found, create one:
touch internal/cookies/cookies.txt
# Then add content from browser export
```

---

### Issue 4: Cookie download fails

**Error**:
```
WARN Failed to download cookie file from https://batbin.me/...: connection refused
```

**Causes & Solutions**:
```
âŒ Batbin URL invalid
   â†’ Copy URL from browser correctly
   â†’ Format: https://batbin.me/PASTE_ID

âŒ Batbin paste expired
   â†’ Pastes expire after ~30 days
   â†’ Create new paste on batbin.me
   â†’ Update COOKIES_LINK

âŒ Network unreachable
   â†’ Check internet connection
   â†’ Check firewall rules
   â†’ Try from different network
```

---

## ðŸš€ Advanced Usage

### Rotating Cookies for Load Balancing

```bash
# Use multiple cookies for different downloads
COOKIES_LINK="https://batbin.me/cookies1 https://batbin.me/cookies2 https://batbin.me/cookies3"

# Each download randomly picks one:
# Download 1: cookies1.txt
# Download 2: cookies3.txt
# Download 3: cookies2.txt
```

**Benefits**:
- âœ… Distribute load across accounts
- âœ… Better rate limit handling
- âœ… Redundancy if one fails
- âœ… Automatic fallback

---

## â° Maintenance Schedule

### Daily
- Bot uses cookies automatically
- No manual action needed

### Weekly
- Monitor download success rates
- If failures increase, cookies may be expiring

### Weekly (or when failures occur)
1. Export fresh cookies from browser
2. Upload to Batbin
3. Update `COOKIES_LINK` in `.env`
4. Restart bot

### Semi-Annually
- Review if alternative downloaders needed
- Check for new YouTube restrictions

---

## ðŸ“Š Best Practices

### âœ… Do's

```bash
âœ… Use Batbin for secure storage
âœ… Refresh cookies monthly
âœ… Use multiple cookies for load balancing
âœ… Monitor download success rates
âœ… Keep COOKIES_LINK up to date
âœ… Test cookies after export
```

### âŒ Don'ts

```bash
âŒ Don't commit cookies to git
âŒ Don't share cookie files publicly
âŒ Don't use same account for multiple bots
âŒ Don't ignore download failures
âŒ Don't use extremely old cookies
âŒ Don't store plaintext passwords
```

---

## ðŸ”— Resources

- **[Batbin](https://batbin.me/)** - Temporary file hosting
- **[Get cookies.txt Extension](https://chrome.google.com/webstore/detail/get-cookiestxt/)** - Chrome extension
- **[yt-dlp Documentation](https://github.com/yt-dlp/yt-dlp)** - Download tool
- **[YouTube Cookie Docs](https://support.google.com/accounts/answer/61416)** - Cookie info

---

## ðŸ†˜ Support

- **Not working?** Use `/bug` command
- **Need help?** Join [Support Chat](https://t.me/TheTeamVk)
- **Found issue?** Report on [GitHub](https://github.com/TheTeamVivek/YukkiMusic/issues)

---

## ðŸ“ Implementation Details

### `cookies.go` Functions

```go
// Initialize and download cookies from Batbin URLs
func init()

// Download single cookie file from Batbin
func downloadCookieFile(url string) error

// Get random cookie file for load balancing
func GetRandomCookieFile() (string, error)

// Load all .txt files from directory into cache
func loadCookieCache() error
```

### Configuration

```go
// In internal/config/config.go
CookiesLink = getString("COOKIES_LINK")  // Space-separated Batbin URLs
```

---

**Happy downloading! ðŸŽµ**
